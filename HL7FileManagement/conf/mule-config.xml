<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mule-configuration PUBLIC "-//MuleSource //DTD mule-configuration XML V1.0//EN"
                                "http://mule.mulesource.org/dtds/mule-configuration.dtd">

<mule-configuration id="Mule_Test" version="1.0">

	<environment-properties>
	<file-properties location="LabProperties.properties" override="false"/>
	</environment-properties>

	<connector name="myFileConnector" className="org.mule.providers.file.FileConnector">
	    <properties>
            <property name="outputPattern" value="${ORIGINALNAME}"/>
			<property name="pollingFrequency" value="60000"/>
	    </properties>
	</connector>

    <transformers>
		<transformer name="FileToByteArray" className="org.mule.custom.providers.file.transformers.FileToByteArray"/>
    </transformers>
	
    <interceptor-stack name="default">
        <interceptor className="org.mule.interceptors.LoggingInterceptor"/>
        <interceptor className="org.mule.interceptors.TimerInterceptor"/>
    </interceptor-stack>
    <!--
        The Mule model initialises and manages your UMO components
    -->
    <model name="oscarUploader">
        <mule-descriptor name="UploaderUMO" implementation="org.mule.custom.Uploader">
            <inbound-router>
                <endpoint address="file:///${incomingHL7dir}?connector=myFileConnector" transformers="FileToByteArray">
					<filter pattern="*.hl7,*.xml" className="org.mule.custom.providers.file.filters.BusyFilter"/>
					<properties>
						<property name="keyLocation" value="${keyLocation}" />
						<property name="oscarURL" value="${oscarURL}"/>
					</properties>
				</endpoint>
            </inbound-router>
			<outbound-router>
                <router className="org.mule.routing.outbound.OutboundPassThroughRouter">
                    <endpoint address="file:///${completedHL7dir}" />
                </router>
            </outbound-router>
            <!--
            Here we tell this component to use the interceptor stack defined above
            -->
            <interceptor name="default"/>
            <!--
            Define the exception strategy to deal with errors
            -->
    		<exception-strategy className="org.mule.custom.CustomExceptionStrategy">
				<!-- Connection refused exceptions will be sent back to the inbound folder so they can try to send again -->
        		<endpoint address="file:///${incomingHL7dir}"/>
				<!-- All other exceptions will be sent to the errors folder -->
        		<endpoint address="file:///${errorHL7dir}"/>
    		</exception-strategy>
        </mule-descriptor>
    </model>
</mule-configuration>
