<!--  
/*
 * 
 * Copyright (c) 2001-2002. Department of Family Medicine, McMaster University. All Rights Reserved. *
 * This software is published under the GPL GNU General Public License. 
 * This program is free software; you can redistribute it and/or 
 * modify it under the terms of the GNU General Public License 
 * as published by the Free Software Foundation; either version 2 
 * of the License, or (at your option) any later version. * 
 * This program is distributed in the hope that it will be useful, 
 * but WITHOUT ANY WARRANTY; without even the implied warranty of 
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the 
 * GNU General Public License for more details. * * You should have received a copy of the GNU General Public License 
 * along with this program; if not, write to the Free Software 
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA. * 
 * 
 * <OSCAR TEAM>
 * 
 * This software was written for the 
 * Department of Family Medicine 
 * McMaster Unviersity 
 * Hamilton 
 * Ontario, Canada 
 */
-->

<!-- May 22, 2002,-->
<%@ page language="java"%>
<%@ taglib uri="/WEB-INF/struts-bean.tld" prefix="bean" %>
<%@ taglib uri="/WEB-INF/struts-html.tld" prefix="html" %>
<%@ taglib uri="/WEB-INF/struts-logic.tld" prefix="logic" %>

<% response.setHeader("Cache-Control","no-cache");%>



<%
oscar.oscarEncounter.pageUtil.SessionBean bean = (oscar.oscarEncounter.pageUtil.SessionBean)pageContext.findAttribute("bean");
    if(bean == null)
    {
        String cookieSecurityName = "myCookie";
        String cookieSecurityValuePassed = null;
        String cookieSecurityValue = "myValue";
        Cookie[] cookies = request.getCookies();
        Cookie cookie;

        for(int i = 0; i <cookies.length;i++)
        {
            cookie = cookies[i];
            if(cookieSecurityName.equals(cookie.getName()))
            {
                cookieSecurityValuePassed = cookies[i].getValue();
            }
        }
        if(cookieSecurityValue.equals(cookieSecurityValuePassed))
        {}
        else
        {
            response.sendRedirect("error.jsp");
        }
    }
%>


<html:html locale="true">



<html>
<head>
<title>oscarEncounter</title>
<html:base/>
<!-- This is from OscarMessenger to get the top and left borders on -->
<link rel="stylesheet" type="text/css" href="encounterStyles.css">
<!--
<script type="application/x-javascript" language="javascript" src="/javascript/sizing.js"></script>
-->

<script type="text/javascript" language=javascript>
    var height = 175;
    var encHeight = 250;
//    var colThreeRows = 7;
    var deltaHeight = 50;
    var pageht = 500;

    var setSize = "width: 400; height: "+height;
    var setEncSize = "width: 803; height: "+encHeight;

//tilde operator function variables
    var handlePressState = 0;
    var handlePressFocus;
    var handlePressFocus2 = "none";
    var keyPressed;
    var textValue1;
    var textValue2;
    var textValue3;

//Nick, height has to be given in pixels in order to dynamically change it
//as far as i could find, there is no way to use the dom to change row values

    function popupStart(vheight,vwidth,varpage) {
      var page = varpage;
      windowprops = "height="+vheight+",width="+vwidth+",location=no,scrollbars=yes,menubars=no,toolbars=no,resizable=yes,screenX=0,screenY=0,top=0,left=0";
      var popup=window.open(varpage, "", windowprops);
      if (popup != null) {
        if (popup.opener == null) {
          popup.opener = self;
        }
      }
    }
    //This function governs the tilde operator functions
    function handlePress(evt){
            //alert("keyCode was " +window.event.keyCode+" handlePresssFocus is "+handlePressFocus+" and handlePressState is "+handlePressState);
            if(evt.which == null)
            {
                //Traps the first tilde
                if ( handlePressState ==0 && window.event.keyCode=="126")
                {
                    handlePressState  = 1;
                }
                //Catches all keypress sequences of ~d that happen in the same textarea and puts the date string in
                else if ((handlePressState ==1) && (window.event.keyCode=="100"))
                {
                    var today = new Date();
                    handlePressState = 0;
                    textValue1 = document.encForm.shTextarea.value;
                    textValue1 = textValue1.replace(/~/g," ["+today.getFullYear()+"/"+today.getMonth()+"/"+today.getDay()+"] ");
                    document.encForm.shTextarea.value = textValue1;

                    textValue1 = document.encForm.fhTextarea.value;
                    textValue1 = textValue1.replace(/~/g," ["+today.getFullYear()+"/"+today.getMonth()+"/"+today.getDay()+"] ");
                    document.encForm.fhTextarea.value = textValue1;

                    textValue1 = document.encForm.mhTextarea.value;
                    textValue1 = textValue1.replace(/~/g," ["+today.getFullYear()+"/"+today.getMonth()+"/"+today.getDay()+"] ");
                    document.encForm.mhTextarea.value = textValue1;

                    textValue1 = document.encForm.ocTextarea.value;
                    textValue1 = textValue1.replace(/~/g," ["+today.getFullYear()+"/"+today.getMonth()+"/"+today.getDay()+"] ");
                    document.encForm.ocTextarea.value = textValue1;

                    textValue1 = document.encForm.enTextarea.value;
                    textValue1 = textValue1.replace(/~/g," ["+today.getFullYear()+"/"+today.getMonth()+"/"+today.getDay()+"] ");
                    document.encForm.enTextarea.value = textValue1;

                    window.event.keyCode = 0;
                }
            //brings the user to view the first row
               else if ((handlePressState ==1) && (window.event.keyCode=="49"))
               {
                    handlePressState = 0;
                    handlePressFocus = "none";
                    textHandle = document.encForm.shTextarea.offsetTop + document.encForm.shTextarea.offsetParent.offsetTop;
                    window.scrollTo(0,textHandle);
                    window.event.keyCode = 0;

                    textValue1 = document.encForm.shTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.shTextarea.value = textValue1;

                    textValue1 = document.encForm.fhTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.fhTextarea.value = textValue1;

                    textValue1 = document.encForm.mhTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.mhTextarea.value = textValue1;

                    textValue1 = document.encForm.ocTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.ocTextarea.value = textValue1;

                    textValue1 = document.encForm.enTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.enTextarea.value = textValue1;

                }
            //brings the user to view the second row
               else if ((handlePressState ==1) && (window.event.keyCode=="50"))
                {
                    handlePressState = 0;
                    handlePressFocus = "none";
                    textHandle = document.encForm.mhTextarea.offsetTop + document.encForm.mhTextarea.offsetParent.offsetTop;
                    window.scrollTo(0,textHandle);
                    window.event.keyCode = 0;

                    textValue1 = document.encForm.shTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.shTextarea.value = textValue1;

                    textValue1 = document.encForm.fhTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.fhTextarea.value = textValue1;

                    textValue1 = document.encForm.mhTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.mhTextarea.value = textValue1;

                    textValue1 = document.encForm.ocTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.ocTextarea.value = textValue1;

                    textValue1 = document.encForm.enTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.enTextarea.value = textValue1;

                }
            //brings the user to view the last row
                else if ((handlePressState ==1) && (window.event.keyCode=="51"))
                {
                    handlePressState = 0;
                    handlePressFocus = "none";
                    textHandle = document.encForm.enTextarea.offsetTop + document.encForm.enTextarea.offsetParent.offsetTop;
                    window.scrollTo(0,textHandle);
                    window.event.keyCode = 0;

                    textValue1 = document.encForm.shTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.shTextarea.value = textValue1;

                    textValue1 = document.encForm.fhTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.fhTextarea.value = textValue1;

                    textValue1 = document.encForm.mhTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.mhTextarea.value = textValue1;

                    textValue1 = document.encForm.ocTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.ocTextarea.value = textValue1;

                    textValue1 = document.encForm.enTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.enTextarea.value = textValue1;

                }
                //Catches all codes not recognized and resets
                else if (handlePressState ==1)
                {
                    handlePressState = 0;
                    textValue1 = document.encForm.shTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.shTextarea.value = textValue1;

                    textValue1 = document.encForm.fhTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.fhTextarea.value = textValue1;

                    textValue1 = document.encForm.mhTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.mhTextarea.value = textValue1;

                    textValue1 = document.encForm.ocTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.ocTextarea.value = textValue1;

                    textValue1 = document.encForm.enTextarea.value;
                    textValue1 = textValue1.replace(/~/g,"");
                    document.encForm.enTextarea.value = textValue1;

                    window.event.keyCode = 0;

                }
            }
            //The w3c parahraph
            else
            {
                keyPressed = evt.which;
                alert("w3c keyPressed == "+keyPressed);
            }

    }


function num(value) {
    var theString = new String(value);
    var st = new String(theString.substring(0, theString.length-2));
    var numberSt = new Number(st);
    //alert('value: '+numberSt.toString());
    return numberSt;
}

function expandTable(textarea) {
    var dheight = deltaHeight;
    var height = num(textarea.style.height) + dheight;
    textarea.style.height = height;

    switch (textarea.name) {
    case document.encForm.shTextarea.name:
        document.encForm.fhTextarea.style.height = num(document.encForm.shTextarea.style.height);
        //document.encForm.shTextarea.style.height = num(document.encForm.fhTextarea.style.height);
        break;
    case document.encForm.mhTextarea.name:
        document.encForm.ocTextarea.style.height = num(document.encForm.mhTextarea.style.height);
        //document.encForm.mhTextarea.style.height = num(document.encForm.ocTextarea.style.height);
        break;
    case document.encForm.enTextarea.name:
        break;
    default:
        document.encForm.shTextarea.style.height = height;
        document.encForm.fhTextarea.style.height = height;
        document.encForm.mhTextarea.style.height = height;
        document.encForm.ocTextarea.style.height = height;
        document.encForm.enTextarea.style.height = encHeight;
    }

}

function shrinkTable(textarea) {
    var dheight = deltaHeight;
    var ht = num(textarea.style.height);

    switch (textarea.name) {
    case document.encForm.shTextarea.name:
        var ht = num(textarea.style.height);
        if( (ht - dheight) > height)
            textarea.style.height = (ht - dheight);
        else
            textarea.style.height = height;
        document.encForm.fhTextarea.style.height = num(document.encForm.shTextarea.style.height);
        break;
    case document.encForm.mhTextarea.name:
        var ht = num(textarea.style.height);
        if( (ht - dheight) > height)
            textarea.style.height = (ht - dheight);
        else
            textarea.style.height = height;
        document.encForm.ocTextarea.style.height = num(document.encForm.mhTextarea.style.height);
        break;
    case document.encForm.enTextarea.name:
        var ht = num(textarea.style.height);
        if( (ht - dheight) > height)
            textarea.style.height = (ht - dheight);
        else
            textarea.style.height = encHeight;
        break;
    default:
        document.encForm.shTextarea.style.height = height;
        document.encForm.fhTextarea.style.height = height;
        document.encForm.mhTextarea.style.height = height;
        document.encForm.ocTextarea.style.height = height;
        document.encForm.enTextarea.style.height = encHeight;
    }
}

function fullPage(textarea) {
    switch (textarea.name) {
    case document.encForm.shTextarea.name:
        textarea.style.height = pageht;
        document.encForm.fhTextarea.style.height = num(document.encForm.shTextarea.style.height);
        break;
    case document.encForm.mhTextarea.name:
        textarea.style.height = pageht;
        document.encForm.ocTextarea.style.height = num(document.encForm.mhTextarea.style.height);
        break;
    case document.encForm.enTextarea.name:
        textarea.style.height = pageht;
        break;
    default:
        document.encForm.shTextarea.style.height = height;
        document.encForm.fhTextarea.style.height = height;
        document.encForm.mhTextarea.style.height = height;
        document.encForm.ocTextarea.style.height = height;
        document.encForm.enTextarea.style.height = encHeight;
    }
}

function collapse(textarea) {
    switch (textarea.name) {
    case document.encForm.shTextarea.name:
        textarea.style.height = height;
        document.encForm.fhTextarea.style.height = num(document.encForm.shTextarea.style.height);
        break;
    case document.encForm.mhTextarea.name:
        textarea.style.height = height;
        document.encForm.ocTextarea.style.height = num(document.encForm.mhTextarea.style.height);
        break;
    case document.encForm.enTextarea.name:
        textarea.style.height = encHeight;
        break;
    default:
        document.encForm.shTextarea.style.height = height;
        document.encForm.fhTextarea.style.height = height;
        document.encForm.mhTextarea.style.height = height;
        document.encForm.ocTextarea.style.height = height;
        document.encForm.enTextarea.style.height = encHeight;
    }
}

function originalSize() {
    document.encForm.shTextarea.style.height = height;
    document.encForm.fhTextarea.style.height = height;
    document.encForm.mhTextarea.style.height = height;
    document.encForm.ocTextarea.style.height = height;
    document.encForm.enTextarea.style.height = encHeight;
}


</script>

</head>

<body  onkeypress="javascript:handlePress(event);" topmargin="0" leftmargin="0" vlink="#0000FF">
<html:errors/>
<!--  -->
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" id="AutoNumber1" height="100%" name="encounterTable">
   <tr>
        <td style="width:110" bgcolor="#000000">

        </td>
        <td  bgcolor="#000000" style="border-left: 2px solid #A9A9A9; padding-left: 5" >
            <table width="100%" name="tileTable">
                <tr>
                    <td>
                        <div class="ScreenTitle">
                            oscarEncounter
                        </div>
                    </td>
                    <td style="text-align:right">
                        <span class="FakeLink" style="text-align:right">
                            <a href="javascript:popupStart(300,400,'Help.jsp')" style="color:#00EEFF">Help</a> | <a href="javascript:popupStart(300,400,'About.jsp')" style="color:#00EEFF">About</a> | <a href="javascript:popupStart(300,400,'License.jsp')" style="color:#00EEFF">License</a>
                        </span>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td valign="top" style="width:110">
        <!-- This is the left-hand start column -->
        <!-- This is the left-hand end column -->
        </td>
        <!-- width="100%" -->
        <td  style="border-left: 2px solid #A9A9A9;" height="100%"  valign="top">
            <form name="encForm">
            <table  name="encounterTableRightCol">



<!----Start new rows here-->
                <tr width="100%">
                    <!----This is the Social History cell ...sh...-->
                    <td  valign="top">
                        <!-- Creating the table tag within the script allows you to adjust all table sizes at once, by changing the value of leftCol -->
                        <script type="text/javascript" language="javascript">
                           document.write("<textarea name='shTextarea' wrap='soft'  style='"+setSize+";background-image:URL(SocialHistory.gif);background-position:right  center;background-repeat:no-repeat'></textarea>");
                        </script>
                    </td>

                    <!----This is the Family History cell ...fh...-->
                    <td  valign="top">
                        <script type="text/javascript" language="javascript">
                           document.write("<textarea name='fhTextarea' wrap='soft'  style='"+setSize+";background-image:URL(FamilyHistory.gif);background-position:right  center;background-repeat:no-repeat'></textarea>");
                        </script>
                    </td>


                    <td width="15" valign="top">
                        <a onMouseOver="javascript:window.status='Increase the Social History viewing area.'; return true;" href="javascript:expandTable(document.encForm.shTextarea);">
                            <img src="graphics/plus.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Decrease the Social History viewing area.'; return true;" href="javascript:shrinkTable(document.encForm.shTextarea);" >
                            <img src="graphics/minus.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Expand the Social History viewing area to a full page.'; return true;" href="javascript:fullPage(document.encForm.shTextarea);" >
                            <img src="graphics/fullscreen.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Reduce the Social History viewing area to its original size.'; return true;" href="javascript:collapse(document.encForm.shTextarea);" >
                            <img src="graphics/collapse.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Return the whole page to its original size.'; return true;"href="javascript:originalSize();">
                            <img src="graphics/collapseAll.gif"/></a><br>
                    </td>
                </tr>

                <tr width="100%">
                    <!----This is the Medical History cell ...mh...-->
                    <td  valign="top">

                        <script type="text/javascript" language="javascript">
                           document.write("<textarea name='mhTextarea'  wrap='soft'  style='"+setSize+";background-image:URL(MedicalHistory.gif);background-position:right  center;background-repeat:no-repeat'></textarea>");
                        </script>
                    </td>
                    <!----This is the Current Problems cell ...cp...-->
                    <td  valign="top">
                        <script type="text/javascript" language="javascript">
                           document.write("<textarea name='ocTextarea' wrap='soft'  style='"+setSize+";background-image:URL(OnGoingConcerns.gif);background-position:right  center;background-repeat:no-repeat'></textarea>");
                        </script>
                    </td>
                    <td  valign="top">
                        <a onMouseOver="javascript:window.status='Increase the Social History viewing area.'; return true;" href="javascript:expandTable(document.encForm.mhTextarea);">
                            <img src="graphics/plus.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Decrease the Social History viewing area.'; return true;" href="javascript:shrinkTable(document.encForm.mhTextarea);" >
                            <img src="graphics/minus.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Expand the Social History viewing area to a full page.'; return true;" href="javascript:fullPage(document.encForm.mhTextarea);" >
                            <img src="graphics/fullscreen.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Reduce the Social History viewing area to its original size.'; return true;" href="javascript:collapse(document.encForm.mhTextarea);" >
                            <img src="graphics/collapse.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Return the whole page to its original size.'; return true;"href="javascript:originalSize();">
                            <img src="graphics/collapseAll.gif"/></a><br>
                    </td>
                </tr>
                <!-- This is the Encounters cell ...en...     -->
                <tr width="100%">
                    <td valign="top" colspan="2">
                            <script type="text/javascript" language="javascript">
                           document.write("<textarea name='enTextarea' wrap='soft'  style='"+setEncSize+";background-image:URL(Encounter.gif);background-position:right  center;background-repeat:no-repeat'></textarea>");
                            </script>
                    </td>
                    <td valign="top">
                        <a onMouseOver="javascript:window.status='Increase the Social History viewing area.'; return true;" href="javascript:expandTable(document.encForm.enTextarea);">
                            <img src="graphics/plus.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Decrease the Social History viewing area.'; return true;" href="javascript:shrinkTable(document.encForm.enTextarea);" >
                            <img src="graphics/minus.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Expand the Social History viewing area to a full page.'; return true;" href="javascript:fullPage(document.encForm.enTextarea);" >
                            <img src="graphics/fullscreen.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Reduce the Social History viewing area to its original size.'; return true;" href="javascript:collapse(document.encForm.enTextarea);" >
                            <img src="graphics/collapse.gif"/></a><br>
                        <a onMouseOver="javascript:window.status='Return the whole page to its original size.'; return true;"href="javascript:originalSize();">
                            <img src="graphics/collapseAll.gif"/></a><br>
                    </td>
                </tr>


<!----End new rows here-->
            </table>
            </form>
        </td>
    </tr>

	<tr>
    	<td height="0%" style="border-bottom:2px solid #A9A9A9; border-top:2px solid #A9A9A9; "></td>
    	<td height="0%" style="border-bottom:2px solid #A9A9A9; border-top:2px solid #A9A9A9; "></td>
  	</tr>
  	<tr>
    	<td width="100%" height="0%" colspan="2">&nbsp;</td>
  	</tr>
  	<tr>
    	<td width="100%" height="0%" style="padding: 5" bgcolor="#DCDCDC" colspan="2"></td>
  	</tr>
</table>
<table><tr style="height:800 px"><td></td></tr></table>


</body>
</html:html>

