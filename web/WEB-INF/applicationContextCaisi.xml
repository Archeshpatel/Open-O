<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd"
        default-autowire="no">

    <bean id="bedAuditStrategy" class="org.oscarehr.PMmodule.dao.hibernate.BedAuditStrategy" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="auditSessionFactory"/>
        </property>
    </bean>
    <bean id="bedDemographicAuditStrategy" class="org.oscarehr.PMmodule.dao.hibernate.BedDemographicAuditStrategy"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="auditSessionFactory"/>
        </property>
    </bean>
    <bean id="roomAuditStrategy" class="org.oscarehr.PMmodule.dao.hibernate.RoomAuditStrategy" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="auditSessionFactory"/>
        </property>
    </bean>
    <!-- DAO -->
    <bean id="SystemMessageDAO" class="org.caisi.dao.SystemMessageDAO" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="issueAdminDAO" class="org.caisi.dao.hibernate.IssueAdminDAOHibernate" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="CaisiRoleDAO" class="org.caisi.dao.CaisiRoleDAO" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="accessTypeDAO" class="org.caisi.dao.jdbc.AccessTypeDAOJdbc" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="dataSource" ref="dataSource"/>
    </bean>
    <bean id="programSignatureDao" class="org.oscarehr.PMmodule.dao.hibernate.ProgramSignatureDaoHibernate"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="bedCheckTimeDAO" class="org.oscarehr.PMmodule.dao.hibernate.BedCheckTimeDAOHibernate" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="ratePageDao" class="org.oscarehr.PMmodule.dao.hibernate.HibernateRatePageDao" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <!-- Generic Intake -->
    <bean id="genericIntakeNodeDAO" class="org.oscarehr.PMmodule.dao.hibernate.GenericIntakeNodeDAOHibernate"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="genericIntakeDAO" class="org.oscarehr.PMmodule.dao.hibernate.GenericIntakeDAOHibernate"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="intakeADao" class="org.oscarehr.PMmodule.dao.hibernate.IntakeADaoHibernate" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="intakeCDao" class="org.oscarehr.PMmodule.dao.hibernate.IntakeCDaoHibernate" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <!-- Generic Intake -->
    <bean id="consentDao" class="org.oscarehr.PMmodule.dao.hibernate.ConsentDAOHibernate" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="logDAO" class="org.oscarehr.PMmodule.dao.hibernate.LogDAOHibernate" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="oscarSecurityDAO" class="org.oscarehr.PMmodule.dao.hibernate.OscarSecurityDAOHibernate"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="formsDAO" class="org.oscarehr.PMmodule.dao.hibernate.FormsDAOHibernate" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="surveyDAO" class="org.oscarehr.survey.dao.hibernate.SurveyDAOHibernate" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="surveyTestDAO" class="org.oscarehr.survey.dao.hibernate.SurveyTestDAOHibernate" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="oscarFormDAO" class="org.oscarehr.survey.dao.oscar.hibernate.OscarFormDAOHibernate" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <bean id="populationReportDAO" class="org.oscarehr.common.dao.PopulationReportDAO" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="sessionFactory">
            <ref bean="sessionFactory"/>
        </property>
    </bean>
    <!-- Transaction manager for a single Hibernate SessionFactory (alternative to JTA) -->
    <!-- managers  -->
    <bean id="SystemMessageManager" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="target">
            <ref bean="SystemMessageManagerTarget"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="save*">PROPAGATION_REQUIRED</prop>
                <prop key="*">PROPAGATION_REQUIRED</prop>
            </props>
        </property>
    </bean>
    <bean id="SystemMessageManagerTarget" class="org.caisi.service.SystemMessageManager" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="systemMessageDAO">
            <ref bean="SystemMessageDAO"/>
        </property>
    </bean>
    <bean id="issueAdminManager" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="target">
            <ref bean="issueAdminManagerTarget"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="save*">PROPAGATION_REQUIRED</prop>
                <prop key="remove*">PROPAGATION_REQUIRED</prop>
                <prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
            </props>
        </property>
    </bean>
    <bean id="issueAdminManagerTarget" class="org.caisi.service.impl.IssueAdminManagerImpl" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="issueAdminDAO">
            <ref bean="issueAdminDAO"/>
        </property>
    </bean>
    <bean id="CaisiRoleManager" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="target">
            <ref bean="CaisiRoleManagerTarget"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="save*">PROPAGATION_REQUIRED</prop>
                <prop key="*">PROPAGATION_REQUIRED</prop>
            </props>
        </property>
    </bean>
    <bean id="CaisiRoleManagerTarget" class="org.caisi.service.impl.CaisiRoleManagerImpl" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="caisiRoleDAO">
            <ref bean="CaisiRoleDAO"/>
        </property>
        <property name="providerDAO">
            <ref bean="providerDao"/>
        </property>
        <property name="accessTypeDAO" ref="accessTypeDAO"/>
    </bean>
    <bean id="roomManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.RoomManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="roomDAO" ref="roomDAO"/>
                <property name="programDAO" ref="programDao"/>
                <property name="bedDAO" ref="bedDAO"/>
            </bean>
        </property>
    </bean>
    <bean id="bedManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.BedManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="bedDAO" ref="bedDAO"/>
                <property name="roomDAO" ref="roomDAO"/>
                <property name="teamDAO" ref="programTeamDAO"/>
                <property name="bedDemographicManager" ref="bedDemographicManager"/>
            </bean>
        </property>
    </bean>
    <bean id="bedCheckTimeManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.BedCheckTimeManagerImpl" lazy-init="default"
                  autowire="default" dependency-check="default">
                <property name="bedCheckTimeDAO" ref="bedCheckTimeDAO"/>
            </bean>
        </property>
    </bean>
    <bean id="ratePageManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.RatePageManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="ratePageDao" ref="ratePageDao"/>
            </bean>
        </property>
    </bean>
    <!-- Generic Intake -->
    <bean id="genericIntakeManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.GenericIntakeManagerImpl" lazy-init="default"
                  autowire="default" dependency-check="default">
                <property name="genericIntakeNodeDAO" ref="genericIntakeNodeDAO"/>
                <property name="genericIntakeDAO" ref="genericIntakeDAO"/>
                <property name="programDAO" ref="programDao"/>
                <property name="admissionDAO" ref="admissionDao"/>
            </bean>
        </property>
    </bean>
    <bean id="intakeAManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.IntakeAManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="intakeADao" ref="intakeADao"/>
                <property name="clientDao" ref="clientDao"/>
                <property name="enabled" value="${intakea.enabled}"/>
                <property name="newClientForm" value="${intakea.newForm}"/>
            </bean>
        </property>
    </bean>
    <bean id="intakeCManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.IntakeCManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="intakeCDao" ref="intakeCDao"/>
                <property name="clientDao" ref="clientDao"/>
                <property name="enabled" value="${intakec.enabled}"/>
                <property name="newClientForm" value="${intakec.newForm}"/>
            </bean>
        </property>
    </bean>
    <!-- Generic Intake -->
    <bean id="consentManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.ConsentManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="consentDao" ref="consentDao"/>
                <property name="clientDao" ref="clientDao"/>
            </bean>
        </property>
    </bean>
    <bean id="agencyManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.AgencyManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="agencyDao" ref="agencyDao"/>
            </bean>
        </property>
    </bean>
    <bean id="logManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.LogManager" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="logDAO" ref="logDAO"/>
            </bean>
        </property>
    </bean>
    <bean id="oscarSecurityManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.OscarSecurityManagerImpl" lazy-init="default"
                  autowire="default" dependency-check="default">
                <property name="oscarSecurityDAO" ref="oscarSecurityDAO"/>
            </bean>
        </property>
    </bean>
    <bean id="formsManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.FormsManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="formsDAO" ref="formsDAO"/>
            </bean>
        </property>
    </bean>
    <bean id="surveyManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.survey.service.impl.SurveyManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="surveyDAO" ref="surveyDAO"/>
            </bean>
        </property>
    </bean>
    <bean id="surveyTestManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.survey.service.impl.SurveyTestManagerImpl" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="surveyTestDAO" ref="surveyTestDAO"/>
            </bean>
        </property>
    </bean>
    <bean id="surveyLaunchManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.survey.service.impl.SurveyLaunchManagerOscar" lazy-init="default"
                  autowire="default" dependency-check="default">
                <property name="oscarFormDAO">
                    <ref bean="oscarFormDAO"/>
                </property>
            </bean>
        </property>
    </bean>
    <bean id="surveyUserManager" class="org.oscarehr.survey.service.impl.UserManagerOscar" lazy-init="default"
          autowire="default" dependency-check="default"/>
    <bean id="populationReportManager" parent="baseTransactionProxy" lazy-init="default" autowire="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.common.service.impl.PopulationReportManagerImpl" lazy-init="default"
                  autowire="default" dependency-check="default">
                <property name="populationReportDAO" ref="populationReportDAO"/>
                <property name="issueDAO" ref="IssueDAO"/>
            </bean>
        </property>
    </bean>
    <!-- ========================= SCHEDULED JOBS ========================= -->
    <bean id="scheduledIntegratorUpdateTask" class="org.springframework.scheduling.timer.ScheduledTimerTask"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="timerTask">
            <bean class="org.oscarehr.PMmodule.task.IntegratorUpdateTask" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="integratorManager">
                    <ref bean="integratorManager"/>
                </property>
                <property name="programManager">
                    <ref bean="programManager"/>
                </property>
                <property name="admissionManager">
                    <ref bean="admissionManager"/>
                </property>
                <property name="providerManager">
                    <ref bean="providerManager"/>
                </property>
                <property name="clientManager">
                    <ref bean="clientManager"/>
                </property>
            </bean>
        </property>
        <property name="delay">
            <!-- run 1 min after start -->
            <value>60000</value>
        </property>
        <property name="period">
            <!-- run every 10 mins -->
            <value>600000</value>
        </property>
    </bean>
    <bean id="scheduledBedProgramDischargeTask" class="org.springframework.scheduling.timer.ScheduledTimerTask"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="timerTask">
            <bean class="org.oscarehr.PMmodule.task.BedProgramDischargeTask" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="programManager">
                    <ref bean="programManager"/>
                </property>
                <property name="bedManager">
                    <ref bean="bedManager"/>
                </property>
                <property name="bedDemographicManager">
                    <ref bean="bedDemographicManager"/>
                </property>
            </bean>
        </property>
        <property name="delay">
            <!-- run 2 min after start -->
            <value>120000</value>
        </property>
        <property name="period">
            <!-- run every 60 mins -->
            <value>3600000</value>
        </property>
    </bean>
    <bean id="scheduledErProgramDischargeTask" class="org.springframework.scheduling.timer.ScheduledTimerTask"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="timerTask">
            <bean class="org.oscarehr.PMmodule.task.ErProgramDischargeTask" lazy-init="default" autowire="default"
                  dependency-check="default">
                <property name="admissionManager">
                    <ref bean="admissionManager"/>
                </property>
                <property name="providerManager">
                    <ref bean="providerManager"/>
                </property>
            </bean>
        </property>
        <property name="delay">
            <!-- run 3 min after start -->
            <value>180000</value>
        </property>
        <property name="period">
            <!-- run every 5 mins -->
            <value>300000</value>
        </property>
    </bean>
    <bean id="scheduledPopulationReportTask" class="org.springframework.scheduling.timer.ScheduledTimerTask"
          lazy-init="default" autowire="default" dependency-check="default">
        <property name="timerTask">
            <bean class="org.oscarehr.common.task.PopulationReportTask" lazy-init="default" autowire="default"
                  dependency-check="default"/>
        </property>
        <property name="delay">
            <!-- run 4 min after start -->
            <value>240000</value>
        </property>
        <property name="period">
            <!-- run every 60 mins -->
            <value>3600000</value>
        </property>
    </bean>
    <bean id="scheduler" class="org.springframework.scheduling.timer.TimerFactoryBean" lazy-init="default"
          autowire="default" dependency-check="default">
        <property name="scheduledTimerTasks">
            <list>
                <ref bean="scheduledIntegratorUpdateTask"/>
                <ref bean="scheduledBedProgramDischargeTask"/>
                <ref bean="scheduledErProgramDischargeTask"/>
                <ref bean="scheduledPopulationReportTask"/>
            </list>
        </property>
    </bean>
    <bean id="QuestionTypes" class="org.oscarehr.survey.model.QuestionTypes" scope="singleton" lazy-init="default"
          autowire="default" dependency-check="default"/>
    <bean id="testmode" class="java.lang.String" lazy-init="default" autowire="default" dependency-check="default">
        <constructor-arg>
            <value>${testmode.enabled}</value>
        </constructor-arg>
    </bean>
</beans>

