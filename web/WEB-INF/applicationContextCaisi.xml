<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd"
        default-autowire="no">

    <!-- audit strategy -->
    <bean id="bedAuditStrategy" class="org.oscarehr.PMmodule.dao.hibernate.BedAuditStrategy" autowire="byName"/>
    <bean id="bedDemographicAuditStrategy" class="org.oscarehr.PMmodule.dao.hibernate.BedDemographicAuditStrategy" autowire="byName"/>
    <bean id="roomAuditStrategy" class="org.oscarehr.PMmodule.dao.hibernate.RoomAuditStrategy" lazy-init="default" autowire="byName"/>

    <!-- DAO -->
    <bean id="systemMessageDAO" class="org.caisi.dao.SystemMessageDAO" autowire="byName"/>
    <bean id="issueAdminDAO" class="org.caisi.dao.IssueAdminDAO" autowire="byName" />
    <bean id="caisiRoleDAO" class="org.caisi.dao.CaisiRoleDAO" autowire="byName" />
    <bean id="accessTypeDAO" class="org.caisi.dao.AccessTypeDAO" autowire="byName"/>
    <bean id="programSignatureDao" class="org.oscarehr.PMmodule.dao.hibernate.ProgramSignatureDaoHibernate" autowire="byName"/>
    <bean id="bedCheckTimeDAO" class="org.oscarehr.PMmodule.dao.hibernate.BedCheckTimeDAOHibernate" autowire="byName" />
    <bean id="ratePageDao" class="org.oscarehr.PMmodule.dao.hibernate.HibernateRatePageDao" autowire="byName" />
    <bean id="genericIntakeNodeDAO" class="org.oscarehr.PMmodule.dao.hibernate.GenericIntakeNodeDAOHibernate" autowire="byName"/>
    <bean id="genericIntakeDAO" class="org.oscarehr.PMmodule.dao.hibernate.GenericIntakeDAOHibernate" autowire="byName"/>
    <bean id="intakeADao" class="org.oscarehr.PMmodule.dao.hibernate.IntakeADaoHibernate" autowire="byName" />
    <bean id="intakeCDao" class="org.oscarehr.PMmodule.dao.hibernate.IntakeCDaoHibernate" autowire="byName" />
    <bean id="consentDao" class="org.oscarehr.PMmodule.dao.hibernate.ConsentDAOHibernate" autowire="byName" />
    <bean id="logDAO" class="org.oscarehr.PMmodule.dao.hibernate.LogDAOHibernate" autowire="byName" />
    <bean id="oscarSecurityDAO" class="org.oscarehr.PMmodule.dao.hibernate.OscarSecurityDAOHibernate" autowire="byName"/>
    <bean id="formsDAO" class="org.oscarehr.PMmodule.dao.hibernate.FormsDAOHibernate" autowire="byName"/>
    <bean id="surveyDAO" class="org.oscarehr.survey.dao.hibernate.SurveyDAOHibernate" autowire="byName"/>
    <bean id="surveyTestDAO" class="org.oscarehr.survey.dao.hibernate.SurveyTestDAOHibernate" autowire="byName"/>
    <bean id="oscarFormDAO" class="org.oscarehr.survey.dao.oscar.hibernate.OscarFormDAOHibernate" autowire="byName"/>
    <bean id="populationReportDAO" class="org.oscarehr.common.dao.PopulationReportDAO" autowire="byName"/>

    <!-- managers  -->
    <bean id="systemMessageManager" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
          lazy-init="default"  dependency-check="default">
        <property name="transactionManager" ref="transactionManager"/>
        <property name="target" ref="systemMessageManagerTarget"/>
        <property name="transactionAttributes">
            <props>
                <prop key="save*">PROPAGATION_REQUIRED</prop>
                <prop key="*">PROPAGATION_REQUIRED</prop>
            </props>
        </property>
    </bean>
    <bean id="systemMessageManagerTarget" class="org.caisi.service.SystemMessageManager" autowire="byName"/>
    <bean id="issueAdminManager" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
          lazy-init="default"  dependency-check="default">
        <property name="transactionManager" ref="transactionManager"/>
        <property name="target" ref="issueAdminManagerTarget"/>
        <property name="transactionAttributes">
            <props>
                <prop key="save*">PROPAGATION_REQUIRED</prop>
                <prop key="remove*">PROPAGATION_REQUIRED</prop>
                <prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
            </props>
        </property>
    </bean>
    <bean id="issueAdminManagerTarget" class="org.caisi.service.impl.IssueAdminManagerImpl" autowire="byName"/>
    <bean id="caisiRoleManager" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
          lazy-init="default"  dependency-check="default">
        <property name="transactionManager" ref="transactionManager"/>
        <property name="target" ref="caisiRoleManagerTarget"/>
        <property name="transactionAttributes">
            <props>
                <prop key="save*">PROPAGATION_REQUIRED</prop>
                <prop key="*">PROPAGATION_REQUIRED</prop>
            </props>
        </property>
    </bean>
    <bean id="caisiRoleManagerTarget" class="org.caisi.service.impl.CaisiRoleManagerImpl" autowire="byName"/>
    <bean id="roomManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.RoomManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <bean id="bedManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.BedManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <bean id="bedCheckTimeManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.BedCheckTimeManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <bean id="ratePageManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.RatePageManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <!-- Generic Intake -->
    <bean id="genericIntakeManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.GenericIntakeManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <bean id="intakeAManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.IntakeAManagerImpl" lazy-init="default"
                  dependency-check="default">
                <property name="intakeADao" ref="intakeADao"/>
                <property name="clientDao" ref="clientDao"/>
                <property name="enabled" value="${intakea.enabled}"/>
                <property name="newClientForm" value="${intakea.newForm}"/>
            </bean>
        </property>
    </bean>
    <bean id="intakeCManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.IntakeCManagerImpl" lazy-init="default"
                  dependency-check="default">
                <property name="intakeCDao" ref="intakeCDao"/>
                <property name="clientDao" ref="clientDao"/>
                <property name="enabled" value="${intakec.enabled}"/>
                <property name="newClientForm" value="${intakec.newForm}"/>
            </bean>
        </property>
    </bean>
    <!-- Generic Intake -->
    <bean id="consentManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.ConsentManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <bean id="agencyManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.AgencyManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <bean id="logManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.LogManager" autowire="byName"/>
        </property>
    </bean>
    <bean id="oscarSecurityManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.OscarSecurityManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <bean id="formsManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.PMmodule.service.impl.FormsManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <bean id="surveyManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.survey.service.impl.SurveyManagerImpl">
                <property name="surveyDAO" ref="surveyDAO"/>
            </bean>
        </property>
    </bean>
    <bean id="surveyTestManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.survey.service.impl.SurveyTestManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <bean id="surveyLaunchManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.survey.service.impl.SurveyLaunchManagerOscar" autowire="byName"/>
        </property>
    </bean>
    <bean id="surveyUserManager" class="org.oscarehr.survey.service.impl.UserManagerOscar" autowire="byName"/>
    <bean id="populationReportManager" parent="baseTransactionProxy" lazy-init="default"
          dependency-check="default">
        <property name="target">
            <bean class="org.oscarehr.common.service.impl.PopulationReportManagerImpl" autowire="byName"/>
        </property>
    </bean>
    <!-- ========================= SCHEDULED JOBS ========================= -->
    <bean id="scheduledIntegratorUpdateTask" class="org.springframework.scheduling.timer.ScheduledTimerTask"
          lazy-init="default"  dependency-check="default">
        <property name="timerTask">
            <bean class="org.oscarehr.PMmodule.task.IntegratorUpdateTask" lazy-init="default"
                  dependency-check="default">
                <property name="integratorManager" ref="integratorManager"/>
                <property name="programManager" ref="programManager"/>
                <property name="admissionManager" ref="admissionManager"/>
                <property name="providerManager" ref="providerManager"/>
                <property name="clientManager" ref="clientManager"/>
            </bean>
        </property>
        <property name="delay" value="60000"/>
        <property name="period" value="600000"/>
    </bean>
    <bean id="scheduledBedProgramDischargeTask" class="org.springframework.scheduling.timer.ScheduledTimerTask"
          lazy-init="default"  dependency-check="default">
        <property name="timerTask">
            <bean class="org.oscarehr.PMmodule.task.BedProgramDischargeTask" lazy-init="default"
                  dependency-check="default">
                <property name="programManager" ref="programManager"/>
                <property name="bedManager" ref="bedManager"/>
                <property name="bedDemographicManager" ref="bedDemographicManager"/>
            </bean>
        </property>
        <property name="delay" value="120000"/>
        <property name="period" value="3600000"/>
    </bean>
    <bean id="scheduledErProgramDischargeTask" class="org.springframework.scheduling.timer.ScheduledTimerTask"
          lazy-init="default"  dependency-check="default">
        <property name="timerTask">
            <bean class="org.oscarehr.PMmodule.task.ErProgramDischargeTask" lazy-init="default"
                  dependency-check="default">
                <property name="admissionManager" ref="admissionManager"/>
                <property name="providerManager" ref="providerManager"/>
            </bean>
        </property>
        <property name="delay" value="180000"/>
        <property name="period" value="300000"/>
    </bean>
    <bean id="scheduledPopulationReportTask" class="org.springframework.scheduling.timer.ScheduledTimerTask"
          lazy-init="default"  dependency-check="default">
        <property name="timerTask">
            <bean class="org.oscarehr.common.task.PopulationReportTask" lazy-init="default"
                  dependency-check="default"/>
        </property>
        <property name="delay" value="240000"/>
        <!-- run every 60 mins -->
        <property name="period" value="3600000"/>
    </bean>
    <bean id="scheduler" class="org.springframework.scheduling.timer.TimerFactoryBean" lazy-init="default"
           dependency-check="default">
        <property name="scheduledTimerTasks">
            <list>
                <ref bean="scheduledIntegratorUpdateTask"/>
                <ref bean="scheduledBedProgramDischargeTask"/>
                <ref bean="scheduledErProgramDischargeTask"/>
                <ref bean="scheduledPopulationReportTask"/>
            </list>
        </property>
    </bean>
    <bean id="QuestionTypes" class="org.oscarehr.survey.model.QuestionTypes" scope="singleton" lazy-init="default"
           dependency-check="default"/>
    <bean id="testmode" class="java.lang.String" lazy-init="default"  dependency-check="default">
        <constructor-arg value="${testmode.enabled}"/>
    </bean>
</beans>

