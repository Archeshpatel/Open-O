<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : ClinicalReports.xml
    Created on : June 17, 2006, 10:18 PM
    Author     : jay
    Description:
        Purpose of the document follows.
        
        IDEAS
        -The numerators are so close they are only off by measurement and interval date, Might be able to make something dynamic from it.
-->

<ClinicalReports>
 <Numerator id ="A1C6" name="Has A1C in last 6 months" type="SQL" description="Number of patient in the denom with at least one a1c test in the last 6months"
            outputfields="demographicNo,providerNo">
    select * from measurements m where   m.demographicNo = '${demographic_no}'  and m.type = 'A1C' and  dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)    
 </Numerator>
 <Numerator id ="LDL12" name="Has LDL in last 12 months" type="SQL" description="Number of patient in the denom with at least one LDL test in the last 12months" >
    select * from measurements m where   m.demographicNo = '${demographic_no}'  and m.type = 'LDL' and  dateObserved >  DATE_SUB(now(),INTERVAL 12 Month)    
 </Numerator>
 <Numerator id ="BP6" name="Has BP in last 6 months" type="SQL" description="Number of patient in the denom with at least one bp test in the last 6months">
    select * from measurements m where   m.demographicNo = '${demographic_no}'  and m.type = 'BP' and  dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)    
 </Numerator>
 
 <Numerator id ="TW" name="Has Triple Whammy in last 6 months" type="SQL" description="Number of patient in the denom with at least one a1c test in the last 6months
   and at least one bp test in the last 6months
   and at least one LDL test in the last 12months" >
    select * from measurements m,measurements m2,measurements m3 
     where   m.demographicNo = '${demographic_no}'  and m.type = 'BP' and  m.dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)    
     and  m2.demographicNo = '${demographic_no}'  and m2.type = 'LDL' and  m2.dateObserved >  DATE_SUB(now(),INTERVAL 12 Month)     
     and  m3.demographicNo = '${demographic_no}'  and m3.type = 'A1C' and  m3.dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)         
 </Numerator>
 
 <Numerator id ="Female" name="Female" type="SQL" description="Number of Men in the denom" >
    select * from demographic  where   demographic_no = '${demographic_no}'  and  sex = 'F'
 </Numerator>
 <Numerator id ="Male" name="Male" type="SQL"  description="Number of Women in the denom">
    select * from demographic  where   demographic_no = '${demographic_no}'  and  sex = 'M'
 </Numerator>
 
 <Numerator id ="19Young" name="19 and younger" type="SQL"  description="Number of patient in the denom 19 and younger">
    select * from demographic d where   demographic_no = '${demographic_no}'  and  DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &gt;= DATE_SUB(now(),INTERVAL 19 Year)
 </Numerator>

 <Numerator id ="20to64Young" name="20 to 64" type="SQL"  description="Number of patient in the denom 20 to 64">
    select * from demographic d where   d.demographic_no = '${demographic_no}'  and  
    DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &gt;= DATE_SUB(now(),INTERVAL 20 Year)
    and DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &lt;= DATE_SUB(now(),INTERVAL 64 Year)
    
 </Numerator>

 <Numerator id ="65Older" name="65 and older" type="SQL"  description="Number of patients in the denom 65 and older">
    select * from demographic d where   demographic_no = '${demographic_no}'  and  
DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &gt;= DATE_SUB(now(),INTERVAL 65 Year)
 </Numerator>
 
 <Numerator id ="mam12m" name="Mammagram in past 12m" type="SQL"  description="Number of patients in the denom that have a mam test in the last 12 months">
  select * from preventions where prevention_type ='MAM' and demographic_no = '${demographic_no}' and prevention_date &gt;= DATE_SUB(now(),INTERVAL 12 Month)
 </Numerator>
 
 <Numerator id ="pap24m" name="Pap in past 12m" type="SQL"  description="Number of patients in the denom that have a pat test in the last 24 months">
  select * from preventions where prevention_type ='PAP' and demographic_no = '${demographic_no}' and prevention_date &gt;= DATE_SUB(now(),INTERVAL 24 Month)
 </Numerator>
   
    
    
    
    <!--
 <Numerator id ="A1C6" name="Has A1C in last 6 months" type="SQL" description="Number of patient in the denom with at least one a1c test in the last 6months" >
    select count(*) as count from measurements m where   m.demographicNo = '${demographic_no}'  and m.type = 'A1C' and  dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)    
 </Numerator>
 <Numerator id ="LDL12" name="Has LDL in last 12 months" type="SQL" description="Number of patient in the denom with at least one LDL test in the last 12months" >
    select count(*) as count from measurements m where   m.demographicNo = '${demographic_no}'  and m.type = 'LDL' and  dateObserved >  DATE_SUB(now(),INTERVAL 12 Month)    
 </Numerator>
 <Numerator id ="BP6" name="Has BP in last 6 months" type="SQL" description="Number of patient in the denom with at least one bp test in the last 6months">
    select count(*) as count from measurements m where   m.demographicNo = '${demographic_no}'  and m.type = 'BP' and  dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)    
 </Numerator>
 
 <Numerator id ="TW" name="Has Triple Whammy in last 6 months" type="SQL" description="Number of patient in the denom with at least one a1c test in the last 6months
   and at least one bp test in the last 6months
   and at least one LDL test in the last 12months" >
    select count(*) as count from measurements m,measurements m2,measurements m3 
     where   m.demographicNo = '${demographic_no}'  and m.type = 'BP' and  m.dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)    
     and  m2.demographicNo = '${demographic_no}'  and m2.type = 'LDL' and  m2.dateObserved >  DATE_SUB(now(),INTERVAL 12 Month)     
     and  m3.demographicNo = '${demographic_no}'  and m3.type = 'A1C' and  m3.dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)         
 </Numerator>
 
 <Numerator id ="Female" name="Female" type="SQL" description="Number of Men in the denom" >
    select count(*) as count from demographic  where   demographic_no = '${demographic_no}'  and  sex = 'F'
 </Numerator>
 <Numerator id ="Male" name="Male" type="SQL"  description="Number of Women in the denom">
    select count(*) as count from demographic  where   demographic_no = '${demographic_no}'  and  sex = 'M'
 </Numerator>
 
 <Numerator id ="19Young" name="19 and younger" type="SQL"  description="Number of patient in the denom 19 and younger">
    select count(*) as count from demographic d where   demographic_no = '${demographic_no}'  and  DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &gt;= DATE_SUB(now(),INTERVAL 19 Year)
 </Numerator>

 <Numerator id ="20to64Young" name="20 to 64" type="SQL"  description="Number of patient in the denom 20 to 64">
    select count(*) as count from demographic d where   d.demographic_no = '${demographic_no}'  and  
    DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &gt;= DATE_SUB(now(),INTERVAL 20 Year)
    and DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &lt;= DATE_SUB(now(),INTERVAL 64 Year)
    
 </Numerator>

 <Numerator id ="65Older" name="65 and older" type="SQL"  description="Number of patients in the denom 65 and older">
    select count(*) as count from demographic d where   demographic_no = '${demographic_no}'  and  
DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &gt;= DATE_SUB(now(),INTERVAL 65 Year)
 </Numerator>
 
 <Numerator id ="mam12m" name="Mammagram in past 12m" type="SQL"  description="Number of patients in the denom that have a mam test in the last 12 months">
  select count(*) as count from preventions where prevention_type ='MAM' and demographic_no = '${demographic_no}' and prevention_date &gt;= DATE_SUB(now(),INTERVAL 12 Month)
 </Numerator>
 
 <Numerator id ="pap24m" name="Pap in past 12m" type="SQL"  description="Number of patients in the denom that have a pat test in the last 24 months">
  select count(*) as count from preventions where prevention_type ='PAP' and demographic_no = '${demographic_no}' and prevention_date &gt;= DATE_SUB(now(),INTERVAL 24 Month)
 </Numerator>

 -->
 <Numerator id ="a1clt0p071" name="A1C lower than 0.071" type="DROOLS"  description="Number of patient in the denom with a a1c lower that 0.071" 
            file="testA1C.drl"/>
 
 <Numerator id ="a1cgt0p079" name="A1C higher than 0.079" type="DROOLS"  description="Number of patient in the denom with a a1c higher that 0.079" 
            file="testA1Cabove7p9.drl"/>
 
 <Numerator id ="bplt131" name="BP lower than 131" type="DROOLS"  description="Number of patient in the denom with a bp lower that 131"
            file="testBPlower131.drl"/>
 
 <Numerator id ="bpgt0p079" name="BP higher than 139" type="DROOLS"  description="Number of patient in the denom with a bp higher that 139"
            file="testBPabove139.drl"/>
           
 <Numerator id ="ldllt2.6" name="LDL lower than 2.6" type="DROOLS"  description="Number of patient in the denom with a LDL lower that 2.6"
            file="testLDLlower2p6.drl"/>
 
 <Numerator id ="valTripWham" name="Triple Whammy incl Vals" type="DROOLS"  description="Number of patient in the denom with a 
    A1C lower 0.071
    and BP  lower 131
    and LDL lower 2.6"
            file="testTripleWhammy.drl"/>
<!--Numerators
  
--> 
 
<!--
 <Denominator id="DMReg" name="Diabetes Registry" 
    type="SQL">select distinct demographic_no from dxresearch where dxresearch_code in ('250') and coding_system = 'icd9'</Denominator> 
 
 <Denominator id="DMRegP" name="Diabetes Registry By Practice" 
    type="SQL" 
    provider="true">select distinct demographic_no from dxresearch,demographic where dxresearch_code in ('250') and coding_system = 'icd9' and dxresearch.demographic_no = demographic.demographic_no and demographic.provider_no = '${provider_no}'</Denominator> 

 <Denominator id="ActPat" name="Active Patients" 
    type="SQL">select distinct demographic_no from demographic  where roster_status = 'A'</Denominator> 
    -->
    
<Denominator id="DMReg" name="Diabetes Registry"
description="Number of patients in DM reg"
type="SQL">select distinct demographic_no from dxresearch where dxresearch_code in ('250') and coding_system = 'icd9' and status = 'A'
</Denominator>

<Denominator id="DMRegbyP" name="Diabetes Registry by practice"
description="Number of patient in DM reg by practice" replaceKeys="provider_no"
type="SQL">select distinct dxresearch.demographic_no from dxresearch, demographic where dxresearch_code in ('250') and coding_system = 'icd9' and dxresearch.status = 'A' and dxresearch.demographic_no = demographic.demographic_no and demographic.provider_no = '${provider_no}'
</Denominator>

<Denominator id="DMRega1c6m" name="Diabetes Registry having HbA1c in last 6m"
description="Number of patient in the DM reg that have a HbA1c in the testing range"
type="SQL">select distinct d.demographic_no from dxresearch d, measurements m where d.dxresearch_code in ('250') and d.coding_system = 'icd9' and d.status = 'A' and d.demographic_no = m.demographicNo and m.type = 'A1C' and  dateObserved >  DATE_SUB(now(),INTERVAL 6 Month) 
</Denominator>

<Denominator id="DMRega1c6mbyP" name="Diabetes Registry having HbA1c in last 6m by practice"
description="Number of patient in the DM reg that have a HbA1c in the testing range by practice" replaceKeys="provider_no"
type="SQL">select distinct d.demographic_no from dxresearch d, measurements m,demographic de where d.dxresearch_code in ('250') and d.coding_system = 'icd9' and d.status = 'A' and d.demographic_no = m.demographicNo and m.type = 'A1C' and  dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)
and d.demographic_no = de.demographic_no and de.provider_no = '${provider_no}'
</Denominator>

<Denominator id="DMRegbp6m" name="Diabetes Registry having BP in last 6m"
description="Number of patient in the DM reg that have a BP in the testing range"
type="SQL">select distinct d.demographic_no from dxresearch d, measurements m where d.dxresearch_code in ('250') and d.coding_system = 'icd9' and d.status = 'A' and d.demographic_no = m.demographicNo and m.type = 'BP' and  dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)
</Denominator>
    
<Denominator id="DMRegbp6mbyP" name="Diabetes Registry having BP in last 6m by practice"
description="Number of patient in the DM reg that have a BP in the testing range by practice" replaceKeys="provider_no"
type="SQL">select distinct d.demographic_no from dxresearch d, measurements m,demographic de where d.dxresearch_code in ('250') and d.coding_system = 'icd9' and d.status = 'A' and d.demographic_no = m.demographicNo and m.type = 'BP' and  dateObserved >  DATE_SUB(now(),INTERVAL 6 Month)
and d.demographic_no = de.demographic_no and de.provider_no = '${provider_no}'
</Denominator>

<Denominator id="DMRegLDL12m" name="Diabetes Registry having LDL in last 12m"
description="Number of patient in the DM reg that have a LDL in the testing range"
type="SQL">select distinct d.demographic_no from dxresearch d, measurements m where d.dxresearch_code in ('250') and d.coding_system = 'icd9' and d.status = 'A' and d.demographic_no = m.demographicNo and m.type = 'LDL' and  dateObserved >  DATE_SUB(now(),INTERVAL 12 Month)
</Denominator>

<Denominator id="DMRegLDL12mbyP" name="Diabetes Registry having LDL in last 12m by practice"
description="Number of patient in the DM reg that have a LDL in the testing range by practice" replaceKeys="provider_no"
type="SQL">select distinct d.demographic_no from dxresearch d, measurements m,demographic de  where d.dxresearch_code in ('250') and d.coding_system = 'icd9' and d.status = 'A' and d.demographic_no = m.demographicNo and m.type = 'LDL' and  dateObserved >  DATE_SUB(now(),INTERVAL 12 Month)
and d.demographic_no = de.demographic_no and de.provider_no = '${provider_no}'
</Denominator>

<Denominator id="TripWham" name="Triple Whammy"
description="And a combined one above (Triple Whammy)"
type="SQL">select distinct d.demographic_no  from measurements m,measurements m2,measurements m3,dxresearch d 
     where   m.demographicNo = d.demographic_no  and  m.type = 'BP'  and  m.dateObserved  &gt;=  DATE_SUB(now(),INTERVAL 6 Month)    
     and  m2.demographicNo   = d.demographic_no  and m2.type = 'LDL' and  m2.dateObserved &gt;=  DATE_SUB(now(),INTERVAL 12 Month)     
     and  m3.demographicNo   = d.demographic_no  and m3.type = 'A1C' and  m3.dateObserved &gt;=  DATE_SUB(now(),INTERVAL 6 Month) 
     and  d.dxresearch_code in ('250') and d.coding_system = 'icd9' and d.status = 'A' 
</Denominator>
    
<Denominator id="TripWhambyP" name="Triple Whammy by practice"
description="And a combined one above (Triple Whammy) by practice" replaceKeys="provider_no"
type="SQL">select distinct d.demographic_no from measurements m,measurements m2,measurements m3,dxresearch d,demographic de 
     where   m.demographicNo = d.demographic_no  and m.type = 'BP'   and  m.dateObserved  &gt;=  DATE_SUB(now(),INTERVAL 6 Month)    
     and    m2.demographicNo = d.demographic_no  and m2.type = 'LDL' and  m2.dateObserved &gt;=  DATE_SUB(now(),INTERVAL 12 Month)     
     and    m3.demographicNo = d.demographic_no  and m3.type = 'A1C' and  m3.dateObserved &gt;=  DATE_SUB(now(),INTERVAL 6 Month)  
     and  d.dxresearch_code in ('250') and d.coding_system = 'icd9' and d.status = 'A' 
     and d.demographic_no = de.demographic_no and de.provider_no = '${provider_no}'
</Denominator>
     
<Denominator id="ActPat" name="Active Patients"
description="Number of active patients"
type="SQL">select distinct demographic_no from demographic  where patient_status = 'AC'
</Denominator>

<Denominator id="ActPatbyP" name="ACtive Patients by practice"
description="Number of active patients by practice" replaceKeys="provider_no"
type="SQL">select distinct demographic_no from demographic  where patient_status = 'AC' and provider_no = '${provider_no}'
</Denominator>
    
<Denominator id="CHFReg" name="Congestive Heart Failure Registry"
description="Number of patients in the Congestive heart failure" 
type="SQL">select distinct demographic_no from dxresearch where dxresearch_code in ('428') and coding_system = 'icd9' and status = 'A'
</Denominator>
    
<Denominator id="CHFRegbyP" name="Congestive Heart Failure Registry by practice"
description="Number of patients in the Congestive heart failure by provider" replaceKeys="provider_no"
type="SQL">select distinct demographic_no from dxresearch,demographic where dxresearch_code in ('428') and coding_system = 'icd9' and dxresearch.status = 'A' and dxresearch.demographic_no = demographic.demographic_no and demographic.provider_no = '${provider_no}'
</Denominator>
    
<Denominator id="HYPReg" name="Hypertension Registry"
description="Number of patient in the Hypertension reg"
type="SQL">select distinct demographic_no from dxresearch where dxresearch_code in ('401') and coding_system = 'icd9' and status = 'A'
</Denominator>


<Denominator id="HYPRegbyP" name="Hypertension Registry by practice"
description="Number of patient in the Hypertension reg by provider" replaceKeys="provider_no"
type="SQL">select distinct demographic_no from dxresearch,demographic where dxresearch_code in ('401') and coding_system = 'icd9' and dxresearch.status = 'A' and dxresearch.demographic_no = demographic.demographic_no and demographic.provider_no = '${provider_no}'
</Denominator>
    
<Denominator id="W50pl" name="Women 50 and over"
description="Total number of women aged 50 and over"
type="SQL">select distinct demographic_no from demographic d where sex = 'F' and 
DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &lt; DATE_SUB(now(),INTERVAL 50 Year)
</Denominator>


<Denominator id="W50plbyP" name="Women 50 and over by practice"
description="Total number of women aged 50 and over in an individual physician’s patient panel" replaceKeys="provider_no"
type="SQL">select distinct demographic_no from demographic d where sex = 'F' and 
DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &lt; DATE_SUB(now(),INTERVAL 50 Year)
and d.provider_no = '${provider_no}'
</Denominator>

<Denominator id="W18t69" name="Women 18-69"
description="Total number of women patients aged 18 to 69 years, who have not had a hysterectomy"
type="SQL">select distinct demographic_no from demographic d where sex = 'F' and 
DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &gt; DATE_SUB(now(),INTERVAL 69 Year)
and 
DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &lt; DATE_SUB(now(),INTERVAL 18 Year)    
</Denominator>

<Denominator id="W18t69byP" name="Women 18-69 by practice"
description="Total number of women patients aged 18 to 69 years, who have not had a hysterectomy, in an individual physician’s patient panel" 
replaceKeys="provider_no"
type="SQL">select distinct demographic_no from demographic d where sex = 'F' and 
DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &gt; DATE_SUB(now(),INTERVAL 69 Year)
and 
DATE_FORMAT(CONCAT( (d.year_of_birth),'-',(d.month_of_birth),'-',(d.date_of_birth)),'%Y-%m-%d') &lt; DATE_SUB(now(),INTERVAL 18 Year)    
and d.provider_no = '${provider_no}'
</Denominator>    
    
</ClinicalReports>    
    

