<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

	<!--  bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location" value="/WEB-INF/jdbc.properties" />
	</bean-->
	
	<bean id="propertyConfigurer"
		class="org.caisi.common.OscarPropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>/WEB-INF/jdbc.properties</value>
				
			</list>
		</property>
		<property name="placeholderPrefix" value="$A{" />
	</bean>

	<!-- bean id="dataSource"
		class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName"
			value="${jdbc.driverClassName}" />
		<property name="url" value="${jdbc.url}" />
		<property name="username" value="${jdbc.username}" />
		<property name="password" value="${jdbc.password}" />
	</bean -->
	
	<bean id="dataSource"
		class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName"
			value="$A{oscar.db_driver}" />
		<property name="url" value="$A{oscar.db_uri}$A{oscar.db_name}" />
		<property name="username" value="$A{oscar.db_username}" />
		<property name="password" value="$A{oscar.db_password}" />
	</bean>

	<!-- Hibernate SessionFactory -->
	<bean id="caisiSessionFactory"
		class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
				
		<property name="mappingDirectoryLocations">
			<!-- only *.hbm.xml will be loaded -->
			<list>
				<value>classpath:org/caisi/model</value>
			</list>
		</property>
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.dialect">
					$A{hibernate.dialect}
				</prop>
				<prop key="hibernate.show_sql">false</prop>
				<prop key="hibernate.cglib.use_reflection_optimizer">false</prop>
				<prop key="hibernate.generate_statistics">true</prop>
			</props>
		</property>
		<property name="eventListeners">
			<map>
				<entry key="merge">
					<bean
						class="org.springframework.orm.hibernate3.support.IdTransferringMergeEventListener" />
				</entry>
			</map>
		</property>
		
	</bean>
	
	<!-- DAO -->
	<bean id="ticklerDAOT" class="org.caisi.dao.hibernate.TicklerDAOHibernate">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	<bean id="demographicDAOT" class="org.caisi.dao.hibernate.DemographicDAOHibernate">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	
	<bean id="providerDAOT" class="org.caisi.dao.hibernate.ProviderDAOHibernate">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	
	<bean id="customFilterDAOT" class="org.caisi.dao.hibernate.CustomFilterDAOHibernate">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	<bean id="consultationDAOT" class="org.caisi.dao.hibernate.ConsultationDAOHibernate">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	<bean id="chartDAOT" class="org.caisi.dao.hibernate.EChartDAOHibernate">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>

	<bean id="SystemMessageDAO" class="org.caisi.dao.hibernate.SystemMessageDAOHibernate">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	<bean id="issueAdminDAO" class="org.caisi.dao.hibernate.IssueAdminDAOHibernate">
        	<property name="sessionFactory">
        		<ref local="caisiSessionFactory"/>
        	</property>
    	</bean>
	<bean id="CaisiRoleDAO" class="org.caisi.dao.hibernate.CaisiRoleDAOHibernate">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	
	<bean id="bedProgramDao" class="org.caisi.dao.hibernate.HibernateBedProgramDao">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	<bean id="admissionDao" class="org.caisi.dao.hibernate.HibernateAdmissionDao">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	
	<bean id="providerDefaultProgramDao" class="org.caisi.dao.hibernate.HibernateProviderDefaultProgramDao">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	<bean id="providerRoleProgramDao" class="org.caisi.dao.hibernate.HibernateProviderRoleProgramDao">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	<bean id="programProviderDAOT" class="org.caisi.dao.hibernate.ProgramProviderDAOHibernate">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>
	<bean id="accessTypeDAO" class="org.caisi.dao.jdbc.AccessTypeDAOJdbc">
		<property name="dataSource">
			<ref local="dataSource"/>
		</property>
	</bean>
	<!-- Transaction manager for a single Hibernate SessionFactory (alternative to JTA) -->
	<bean id="transactionManager"
		class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory">
			<ref local="caisiSessionFactory"/>
		</property>
	</bean>

	<bean id="baseTransactionProxy"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
		abstract="true">
		<property name="transactionManager" ref="transactionManager" />
		<property name="transactionAttributes">
			<props>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>
	
	<!-- managers  -->
	<bean id="ticklerManagerT" 
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref local="transactionManager"/>
		</property>
		<property name="target">
			<ref local="ticklerManagerTarget"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="save*">PROPAGATION_REQUIRED</prop>
				<prop key="remove*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<bean id="ticklerManagerTarget"
		class="org.caisi.service.impl.TicklerManagerImpl">
		<property name="ticklerDAO">
			<ref local="ticklerDAOT"/>
		</property>
		<property name="customFilterDAO">
			<ref local="customFilterDAOT"/>
		</property>
	</bean>

	<bean id="demographicManagerT" 
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref local="transactionManager"/>
		</property>
		<property name="target">
			<ref local="demographicManagerTarget"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="save*">PROPAGATION_REQUIRED</prop>
				<prop key="remove*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<bean id="demographicManagerTarget"
		class="org.caisi.service.impl.DemographicManagerImplTickler">
		<property name="demographicDAO">
			<ref local="demographicDAOT"/>
		</property>
	</bean>
	
	<bean id="providerManagerT" 
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref local="transactionManager"/>
		</property>
		<property name="target">
			<ref local="providerManagerTarget"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<bean id="providerManagerTarget"
		class="org.caisi.service.impl.ProviderManagerImplTickler">
		<property name="providerDAO">
			<ref local="providerDAOT"/>
		</property>
		<property name="programProviderDAO">
			<ref local="programProviderDAOT"/>
		</property>
	</bean>

	<bean id="preparedTicklerManagerT" 
		class="org.caisi.tickler.prepared.PreparedTicklerManager"
		singleton="true"
		>
	</bean>
	
		<bean id="consultationManager" 
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref local="transactionManager"/>
		</property>
		<property name="target">
			<ref local="consultationManagerTarget"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="save*">PROPAGATION_REQUIRED</prop>
				<prop key="remove*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<bean id="consultationManagerTarget"
		class="org.caisi.service.impl.ConsultationManagerImpl">
		<property name="consultationDAO">
			<ref local="consultationDAOT"/>
		</property>
	</bean>
	
	
	
	<bean id="chartManagerT" 
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref local="transactionManager"/>
		</property>
		<property name="target">
			<ref local="chartManagerTarget"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="save*">PROPAGATION_REQUIRED</prop>
				<prop key="remove*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<bean id="chartManagerTarget"
		class="org.caisi.service.impl.EChartManagerImpl">
		<property name="chartDAO">
			<ref local="chartDAOT"/>
		</property>
	</bean>
	
	<bean id="SystemMessageManager" 
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref local="transactionManager"/>
		</property>
		<property name="target">
			<ref local="SystemMessageManagerTarget"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="save*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<bean id="SystemMessageManagerTarget"
		class="org.caisi.service.impl.SystemMessageManagerImpl">
		<property name="systemMessageDAO">
			<ref local="SystemMessageDAO"/>
		</property>
	</bean>

 	<bean id="issueAdminManager"
        	class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
    		<property name="transactionManager">
        		<ref local="transactionManager"/>
    		</property>
    		<property name="target">
        		<ref local="issueAdminManagerTarget"/>
    		</property>
    		<property name="transactionAttributes">
        		<props>
            			<prop key="save*">PROPAGATION_REQUIRED</prop>
            			<prop key="remove*">PROPAGATION_REQUIRED</prop>
            			<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
        		</props>
    		</property>
    	</bean>

    	<bean id="issueAdminManagerTarget" class="org.caisi.service.impl.IssueAdminManagerImpl">
    		<property name="issueAdminDAO">
			<ref local="issueAdminDAO"/>
		</property>
    	</bean>
	
	
	<bean id="CaisiRoleManager" 
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref local="transactionManager"/>
		</property>
		<property name="target">
			<ref local="CaisiRoleManagerTarget"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="save*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<bean id="CaisiRoleManagerTarget"
		class="org.caisi.service.impl.CaisiRoleManagerImpl">
		<property name="caisiRoleDAO">
			<ref local="CaisiRoleDAO"/>
		</property>
		<property name="providerDAO">
			<ref local="providerDAOT"/>
		</property>
		<property name="accessTypeDAO" ref="accessTypeDAO"/>
	</bean>
	
	<bean id="infirmBedProgramManager" parent="baseTransactionProxy">
		<property name="target">
			<bean class="org.caisi.service.impl.InfirmBedProgramManagerImpl" autowire="byType" />
		</property>
	</bean>

	
	
	<bean id="version" class="org.caisi.service.impl.VersionImpl">
		<property name="version">
			<value>2.5.0</value>
		</property>
	</bean>
</beans>

