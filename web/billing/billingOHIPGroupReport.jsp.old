 <% 
  if(session.getValue("user") == null)
    response.sendRedirect("../logout.jsp");
  String user_no="";
user_no = (String) session.getAttribute("user");
%> 
<%@ page import="java.util.*, java.sql.*, oscar.*, java.net.*" errorPage="errorpage.jsp" %>
<%@ include file="../admin/dbconnection.jsp" %>
<jsp:useBean id="apptMainBean" class="oscar.AppointmentMainBean" scope="session" />
<jsp:useBean id="SxmlMisc" class="oscar.SxmlMisc" scope="session" />
<%@ include file="dbBilling.jsp" %>
<% 	GregorianCalendar now=new GregorianCalendar();
  int curYear = now.get(Calendar.YEAR);
  int curMonth = (now.get(Calendar.MONTH)+1);
  int curDay = now.get(Calendar.DAY_OF_MONTH);
  String nowDate = String.valueOf(curYear)+"/"+String.valueOf(curMonth) + "/" + String.valueOf(curDay)+ " " +now.get(Calendar.HOUR_OF_DAY)+":"+now.get(Calendar.MINUTE) + ":"+now.get(Calendar.SECOND);
  String monthCode = "";
  if (curMonth == 1) monthCode = "A";
    if (curMonth == 2) monthCode = "B";
      if (curMonth == 3) monthCode = "C";
        if (curMonth == 4) monthCode = "D";
          if (curMonth == 5) monthCode = "E";
            if (curMonth == 6) monthCode = "F";
              if (curMonth == 7) monthCode = "G";
                if (curMonth == 8) monthCode = "H";
                  if (curMonth == 9) monthCode = "I";
                    if (curMonth == 10) monthCode = "J";
                      if (curMonth == 11) monthCode = "K";
                        if (curMonth == 12) monthCode = "L";
     String ohipdownload = oscarVariables.getProperty("HOME_DIR") ;;
     session.setAttribute("ohipdownload", ohipdownload);      
  %>

<html>
<head>
<title>Billing Report</title>
<meta http-equiv="Content-Type" content="text/html; ">
<script language="JavaScript">
<!--

function setfocus() {
  this.focus();
}
//-->
</script>
</head>

<body bgcolor="#FFFFFF" text="#000000">
<table border="0" cellspacing="0" cellpadding="0" width="100%"  onLoad="setfocus()" rightmargin="0" topmargin="0" leftmargin="0">
    <tr bgcolor="#486ebd">
     <th align='LEFT'>
		<input type='button' name='print' value='Print' onClick='window.print()'> </th> 
    <th align='CENTER'  ><font face="Arial, Helvetica, sans-serif" color="#FFFFFF"> 
      OHIP Group Report</font></th>
      <th align='RIGHT'><input type='button' name='close' value='Close' onClick='window.close()'></th>
  </tr>
</table>


<table width="100%" border="0" bgcolor="#E6F0F7">
  <form name="form1" method="post" action="genGroupReport.jsp">
    <tr> 
      <td width="220"><b><font face="Arial, Helvetica, sans-serif" size="2" color="#003366">Select 
        provider </font></b></td>
      <td width="254"><b><font face="Arial, Helvetica, sans-serif" size="2" color="#003366"> 
        <select name="provider">
          <option value="all">All Providers</option>
          <% String proFirst="";
           String proLast="";
           String proOHIP="";
           String specialty_code; 
String billinggroup_no;
           int Count = 0;
        ResultSet rslocal;
        rslocal = null;
 rslocal = apptMainBean.queryResults("%", "search_provider_dt");
 while(rslocal.next()){
 proFirst = rslocal.getString("first_name");
 proLast = rslocal.getString("last_name");
 proOHIP = rslocal.getString("ohip_no"); 
 billinggroup_no= SxmlMisc.getXmlContent(rslocal.getString("comments"),"<xml_p_billinggroup_no>","</xml_p_billinggroup_no>");
 specialty_code = SxmlMisc.getXmlContent(rslocal.getString("comments"),"<xml_p_specialty_code>","</xml_p_specialty_code>");


 %>
          <option value="<%=proOHIP%>,<%=specialty_code%>|<%=billinggroup_no%>" ><%=proLast%>, 
          <%=proFirst%></option>
          <% 

 }
// apptMainBean.closePstmtConn();
  %>
        </select>
        </font></b></td>
      <td width="181"><b><font face="Arial, Helvetica, sans-serif" size="2">Select 
        billing center</font></b></td>
      <td width="254"><font face="Arial, Helvetica, sans-serif" size="2"> 
        <select name="billcenter">
        
        <% String centerCode="";
           String centerDesc="";
           
           int Count1 = 0;
        ResultSet rsCenter;
        rsCenter = null;
 rsCenter = apptMainBean.queryResults("%", "search_bill_center");
 while(rsCenter.next()){
 centerCode = rsCenter.getString("billcenter_code");
 centerDesc = rsCenter.getString("billcenter_desc");
  
 %>
            <option value="<%=centerCode%>" <%=oscarVariables.getProperty("billcenter").compareTo(centerCode)==0?"selected":""%>><%=centerDesc%></option>
<% } %>
 </select></td>
 <td width="277"> <font color="#003366"> 
        <input type="submit" name="Submit" value="Create Report">
        <input type="hidden" name="monthCode" value="<%=monthCode%>">
        <input type="hidden" name="verCode" value="V03">
        <input type="hidden" name="curUser" value="<%=user_no%>">
        <input type="hidden" name="curDate" value="<%=nowDate%>">
        </font></td>
    </tr>
    <tr> 
      <td colspan="4"><font color="#003366"><b><font face="Arial, Helvetica, sans-serif" size="2"> 
        </font></b><font face="Arial, Helvetica, sans-serif" size="2"> </font></font><font color="#003366"><b><font face="Arial, Helvetica, sans-serif" size="2"> 
        </font></b><font face="Arial, Helvetica, sans-serif" size="2"> </font></font> 
      </td>
    </tr>
  </form>
</table>
<table width="100%" border="1" cellspacing="0" cellpadding="0" bgcolor="#B1D3EF">
  <tr> 
    <td colspan="6"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366"> 
      <b>Activity List </b></font></td>
  </tr>
  <tr> 
    <td width="14%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366">Provider</font></td>
    <td width="12%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366">Group 
      Number</font></td>
    <td width="16%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366">Creation 
      Date </font></td>
    <td width="15%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366">Claims/Records</font></td>
    <td width="19%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366">Ohip 
      Filename</font></td>
    <td width="24%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366">HTML 
      Filename</font></td>
  </tr>
  
  <%
   String pro_ohip="", pro_group="", updatedate="", cr="", oFile="", hFile="";
   rslocal = null;
   rslocal = apptMainBean.queryResults(curYear+"/01/01", "search_billactivity");
   while(rslocal.next()){
   pro_ohip = rslocal.getString("providerohipno"); 
   pro_group = rslocal.getString("groupno");
   updatedate = rslocal.getString("updatedatetime");
   cr = rslocal.getString("claimrecord");
   oFile = rslocal.getString("ohipfilename");
   hFile = rslocal.getString("htmlfilename");
 

   %>

  <tr> 
    <td width="14%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366"><%=pro_ohip%></font></td>
    <td width="12%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366"><%=pro_group%></font></td>
    <td width="16%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366"><%=updatedate%></font></td>
    <td width="15%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366"><%=cr%></font><font face="Arial, Helvetica, sans-serif" size="2" color="#003366"></font></td>
   <td width="19%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366"><a href="../servlet/OscarDownload?homepath=ohipdownload&filename=<%=oFile%>" target="_blank"><%=oFile%></a></font></td>
    <td width="24%"><font face="Arial, Helvetica, sans-serif" size="2" color="#003366"><a href="../servlet/OscarDownload?homepath=ohipdownload&filename=<%=hFile%>" target="_blank"><%=hFile%></a></font></td>
  </tr>            
  <%  }
  
   
 apptMainBean.closePstmtConn();
  %>
</table>
</body>
</html>
